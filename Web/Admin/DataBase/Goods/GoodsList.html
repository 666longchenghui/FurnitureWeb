<script src="/Admin/BJUI/ComJS/PageNumber.js"></script>
<script type="text/javascript">
    function pic_form_upload_success(data) {
        var json = jQuery.parseJSON(data);
        DWZ.ajaxDone(json);
        if (json.statusCode == DWZ.statusCode.ok) {
            $('#j_form_pic').val(json.navTabId);
            $('#j_form_span_pic').html('<img src="' + json.navTabId + '" width="100" />');
        }
    }
    var PageSize = 15;//每页显示2条数据
    var PageIndex = 1;//当前页为一
    var TotalPage;//总记录数
    var MaxPage;//一共多少页
    function Page() {
        var GoodsName = $("#Goods_Name").val();
        var GoodsModel = $("#Goods_Model").val();
        $.ajax({
            url: "/Ajax/AjaxGoods.ashx?action=GetGoodInfo",
            type: "post",
            data: {
                "GoodsName": GoodsName,
                "GoodsModel":GoodsModel,
                "PageSize": PageSize,
                "PageIndex":PageIndex
            },
            success: function (msg) {
                var json = JSON.parse(msg);
                //通过转换取出总记录数            
                var count = json["ComCount"];
                    count = JSON.parse(count);
                TotalPage = count[""][0]["Column1"];
                //求出总页数总记录数/每页显示的条数，向上取整Math.ceil();
                MaxPage = Math.ceil(TotalPage / PageSize);
                //取出数据
                var data = json["ComStr"];
                data = JSON.parse(data);
                var ObjData = data[""];
                //循环输出每列
                var html = [];
                var Row = ((PageIndex - 1) * PageSize) + 1;
                $.each(ObjData, function (k, v) {
                    var Sum=v.Msum;
                    var Price=v.Msellingprice;
                    var TotalSum = Sum * Price;

                    html.push("<tr><td>" + (Row++) + "</td><td>" + v["Mnumber"] + "</td><td>" + v["Mname"] + "</td><td>" + v["Msellingprice"] + "</td>")
                    html.push("<td>" + v["DataText"] + "</td><td>" + v["UnitName"] + "</td><td>" + v["MCreateDate"] + "</td>")
                    html.push("<td><a href='/Ajax/AjaxGoods.ashx?action=DelMerchandise&Merid=" + v.Mid + "' class='btn btn-red' data-toggle='doajax' data-confirm-msg='确定要删除该行信息吗？'>删除</a>")
                    html.push("<a  class='btn btn-green' onclick='EdGoodsList(this,\"" + v["Mid"] + "\",\"" + v["Mname"] + "\")' >编辑</a></td>")
                    html.push("</tr>")
                })
                $("#MsellingpriceInfo tbody").empty().append(html.join(''));
                $("#total").html(TotalPage);
                //循环出页码
                PageNum(MaxPage, PageIndex);

                $("#GoodsList_Page").empty().append(htmls.join(''));
           
                if (PageIndex==1) {
                    $(".c-first").addClass("disabled");
                    $(".c-prev").addClass("disabled");
                }
                if (PageIndex==MaxPage) {
                    $(".c-next").addClass("disabled");
                    $(".c-last").addClass("disabled");
                }
            }
     });
    }
    //下一页
    function next() {
        if (PageIndex < MaxPage) {
            PageIndex++;
            Page();
        }
    }
    //上一页
    function prev() {
        if (PageIndex>1) {
            PageIndex--;
            Page();
        }
    }
    function search() {
        pageIndex = 1;
            Page();
    }
    //首页
    function first() {
        PageIndex = 1;
        Page();
    }
    function last() {
        PageIndex = MaxPage;
        Page();
    }
    $(function () {
        Page();
        //点击页码跳转
        $(".j-sum").live("click", function () {
            var ClickValue = $(this).text();
            PageIndex = ClickValue;          
            Page();
        });
        //选择下拉值跳转
        $("#div_GoodsPage").live("change", function () {
            var GoodsSelect = $("#Select_GoodsPage").find("option:selected").text();
            if (GoodsSelect > PageIndex) {
                PageIndex = 1;
            }
            PageSize = GoodsSelect;
            Page();
        });
    })
    //输入跳转
    function Jump() {
        $(".goto").live("click", function () {
            var InputValue = $("#go").val();           
            PageIndex = InputValue;
            Page();
        });
    }
    var Goodsid;
    function EdGoodsList(_this, id, name) {
       Goodsid = id;
        $(_this).dialog({ id: 'AddGoodsid', onClose:"addGoods_close", url: '/Admin/DataBase/Goods/AddGoods.html?id=' + id + '', title: "编辑-" + name, reloadWarn: '本页已有打开的内容，确定将刷新本页内容，是否继续？', width: '800',height:400 });
    }
    function addGoods_close($dialog) {
        Goodsid = undefined;
    }
    //清空查询
    function ClearSelect() {
        $("#Goods_Name").val("");
        $("#Goods_Model").val("");
        Page();
    }
    //查询
    function GoodsSelect() {
        var GoodsName = $("#Goods_Name").val();
        Page();
    }
</script>
<div class="bjui-pageHeader">
        <div class="bjui-searchBar">
            <label>商品名称：</label><input type="text" value="" name="name" class="form-control" size="8" id="Goods_Name">&nbsp;
            <label>商品型号：</label><input type="text" value="" name="Model" class="form-control" size="8" id="Goods_Model">&nbsp;
            <button type="submit" class="btn-default" data-icon="search" onclick="GoodsSelect()">查询</button>&nbsp;
            <a class="btn btn-orange" href="javascript:;" data-toggle="reloadsearch" data-clear-query="true" data-icon="undo" onclick="ClearSelect()">清空查询</a>
            <div class="pull-right">
                <!--<button type="button" class="btn-blue" data-toggle="doajax" onclick='Add(this)' id="Btn_AddSupplier" data-icon="" title="可以在控制台(network)查看被删除ID">添加商品</button>&nbsp;-->
                <a href="/Admin/DataBase/Goods/AddGoods.html" class="btn btn-blue" data-toggle="dialog" data-width="800" data-height="400" data-id="AddGoodsid" ata-icon="user" data-mask="true">
                <i class="fa fa-plus-square" size="10" aria-hidden="true">添加商品信息</i></a>    
            </div>
        </div>
</div>
<div class="bjui-pageContent tableContent">
    <table class="table table-bordered table-hover table-striped table-top" data-selected-multi="true" id="MsellingpriceInfo">
        <thead>
            <tr>
                <th data-order-field="operation" align="center">序号</th>
                <th data-order-field="operation" align="center">商品编号</th>
                <th data-order-field="name">商品名称</th>
                <th>价格</th>      
                <th>型号</th>
                <th data-order-field="sex">单位</th>
                <th data-order-field="">创建时间</th>       
                <th width="100">操作</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</div>
<div class="bjui-pageFooter">
    <div class="pages">
        <span>每页&nbsp;</span>
        <div class="selectPagesize" id="div_GoodsPage">
            <select data-toggle="selectpicker" id="Select_GoodsPage">
                <option value="15">15 </option>
                <option value="30">30 </option>
                <option value="50">50 </option>
                <option value="100">100 </option>        
            </select>
        </div>
        <span>&nbsp;条，共 <span id="total"></span> 条</span>
    </div>
    <div class="pagination-box" id="GoodsList_Page" data-total="600" data-page-size="30" data-page-current="1"> 
      </div>
</div>