<script src="/Admin/BJUI/ComJS/PageNumber.js"></script>
<script type="text/javascript">
    //var WHIndex = 1;
    //var WHSize = 15;
    //var WHTotal;
    //var WHMax;
    var ware = { index: 1, size: 2, total: 0, max: 0 };
    function WHList() {
        var WareHouseName = $("#WareHouseName").val();
        $.ajax({
            url: "/Ajax/AjaxWareHouse.ashx?action=GetWHPage",
            type: "post",
            data: {
                "WareHouseName":WareHouseName,
                "WHIndex": ware.index,
                 "WHSize":ware.size
             },
            success: function (msg) {
                var json = JSON.parse(msg);
                var data = json["Page"];
                data = JSON.parse(data);
                var ObjData = data[""];
                var count = json["Count"];
                count = JSON.parse(count);
                ware.total = count[""][0]["Column1"];//总条数
                ware.max = Math.ceil(ware.total / ware.size);//总页数
                var numbers = (ware.index - 1) * ware.size;
                var html = [];
                $.each(ObjData, function (k, v) {                   
                    html.push("<tr>")
                    html.push("<td>"+(++numbers)+"</td>")
                    html.push("<td>" + v["WareName"] + "</td>")
                    html.push("<td>" + v["WHContacts"] + "</td><td>" + v["WHPhone"] + "</td>")
                    html.push("<td>" + v["WareHousDate"] + "</td><td>" + v["WareHouseAddress"] + "</td>")
                    //if (v["DepotStatus"] == 0 ) {
                    //    html.push("<td><a href=#' class='btn btn-green' >正常</a></td>")
                    //}
                    //if (v["DepotStatus"] == 1) {
                    //    html.push("<td><a href='#' class='btn btn-red' >已满</a></td>")
                    //}

                    html.push("<td><a href='/Ajax/AjaxWareHouse.ashx?action=DelWareHouse&pid=" + v["Depotid"] + "' class='btn btn-red' data-toggle='doajax' data-confirm-msg='确定要删除该行信息吗？'>删除</a>&nbsp")
                    html.push("<a href='#' onclick='UpdateDepot(this,\"" + v["Depotid"] + "\",\"" + v["WareName"] + "\")' class='btn btn-green' >编辑</a></td>")
                    html.push("</tr>")
                });
                $("#WareHouse tbody").empty().append(html.join(''));            
                $("#WareCount").html(ware.total);
                htmls = [];
                htmls.push("<ul class='pagination'>");
                htmls.push("<li class='w-first'><a href='javascript:'onclick='ware_first()'><span class='first'><i class='fa fa-step-backward'></i>首页</span></a></li>");
                htmls.push("<li class='w-prev'><a href='javascript:' onclick='ware_prev()'><span class='previous'><i class='fa fa-backward'></i>上一页</span></li>");
                //循环出页码
                for (var i = 1; i <= ware.max; i++) {
                    var cs = "j-sum";
                    if (i == ware.index) {
                        cs = "selected " + cs;
                    }
                    htmls.push("<li class='" + cs + "'><a href='javascript:'> " + i + "</a></li>")//显示页码
                }
                htmls.push("<li class='w-next' ><a href='javascript:' id='n' onclick='ware_next()'><span class='c_next' ><i class='fa fa-forward'></i>下一页</span></li>");
                htmls.push("<li class='w-last'><a href='javascript:' onclick='ware_last()' ><i class='fa fa-step-forward'></i>末页</a></li>")
                htmls.push('<li class="w-jumpto"><span class="p-input"><input class="form-control input-sm-pages" type="text" size="2.6" value="" title="输入跳转页码，回车确认" id="wgo"></span><a class="wgoto" href="javascript:;" title="跳转" onclick="ware_Jump()" ><i class="fa fa-chevron-right"></i></a></li>')
                htmls.push("<ul>");
                $("#ware_pageination").empty().append(htmls.join(''));
                //如果当前页等于1，让首页、上一页不可点击
                if (ware.index == 1) {
                    $(".w-first").addClass("disabled");
                    $(".w-prev").addClass("disabled");
                }
                //如果当前页等于最大页数,让下一页、尾页不可点击
                if (ware.index == ware.max) {
                    $(".w-next").addClass("disabled");
                    $(".w-last").addClass("disabled");
                }
            }
        });
    }
    //首页
    function ware_first() {
        ware.index = 1;
        WHList();
    }
    //尾页
    function ware_last() {
        ware.index = ware.max;
        WHList();
    }
    //上一页
    function ware_prev() {
        if (ware.index > 1) {
            ware.index--;
            WHList();
        }
    }
    //下一页
    function ware_next() {
        if (ware.index < ware.max) {
            ware.index++;
            WHList();
        }
    }
    var WareHouseid;
    function UpdateDepot(_this, id, name) {
        WareHouseid = id;
        $(_this).dialog({ id: 'AddWareHouseid', onClose: "addWareHouse_close", url: '/Admin/DataBase/WareHouse/AddWareHouse.html?id=' + id + '', title: "编辑-" + name, reloadWarn: '本页已有打开的内容，确定将刷新本页内容，是否继续？', width: '800' });
    }
    function addWareHouse_close($dialog) {
        WareHouseid = undefined;
    }
    function ware_Jump() {
        $(".wgoto").live("click", function () {
            var InputValue = $("#wgo").val();
    
            if (InputValue > ware.max) {
                $(this).alertmsg('info', '你输入的数字超过页码范围');
                return false;
            }       
            if (isNaN(Number(InputValue)) || InputValue == "") {
                $(this).alertmsg('info', '请输入数字');
                return;
            }
            if (InputValue < 1) {
                $(this).alertmsg('info', "请输入大于1的数字");
                return;
            }
            ware.index = InputValue;
            WHList();
        });
    }
    $(function () {
        WHList();
        //点击页码跳转到相应页面
            $(".j-sum").live("click", function () {
                var ClickValue = $(this).text();
                ware.index = ClickValue;
                WHList();
            });
            $("#Select_WareHouse").live("change", function () {
                var Selectvalue=$("#Select_WareHouse").find("option:selected").text();
                if (Selectvalue > ware.total) {
                    ware.index = 1;
                }
                ware.size = Selectvalue;
                WHList();
            })
    });
    function ClearSelect() {
        $("#WareHouseName").val("");
        WHList();
    }
    function WareHouseSelect() {

        WHList();
    }
</script>
<div class="bjui-pageHeader">

        <div class="bjui-searchBar">    
            <label>仓库名称：</label><input type="text" value="" id="WareHouseName"class="form-control" size="8">&nbsp;

            <button type="button" class="btn-default" data-icon="search" onclick="WareHouseSelect()">查询</button>&nbsp;
            <a class="btn btn-orange" href="javascript:;" data-toggle="reloadsearch" data-clear-query="true" data-icon="undo" onclick="ClearSelect()">清空查询</a>
            <div class="pull-right">
                <a href="/Admin/DataBase/WareHouse/AddWareHouse.html" class="btn btn-blue" data-toggle="dialog" data-width="800" data-height="400" data-id="AddWareHouseid" ata-icon="user" data-mask="true"><i class="fa fa-plus-square" size="10" aria-hidden="true">新增仓库</i></a>
                <!--<div class="btn-group">
                    <button type="button" class="btn-default dropdown-toggle" data-toggle="dropdown" data-icon="copy">复选框-批量操作<span class="caret"></span></button>
                    <ul class="dropdown-menu right" role="menu">
                        <li><a href="book1.xlsx" data-toggle="doexport" data-confirm-msg="确定要导出信息吗？">导出<span style="color: green;">全部</span></a></li>
                        <li><a href="book1.xlsx" data-toggle="doexportchecked" data-confirm-msg="确定要导出选中项吗？" data-idname="expids" data-group="ids">导出<span style="color: red;">选中</span></a></li>
                        <li class="divider"></li>
                        <li><a href="/B-JUI/ajaxDone2.html" data-toggle="doajaxchecked" data-confirm-msg="确定要删除选中项吗？" data-idname="delids" data-group="ids">删除选中</a></li>
                    </ul>
                </div>-->
            </div>
        </div>
</div>
<div class="bjui-pageContent tableContent">
    <table class="table table-bordered table-hover table-striped table-top" data-selected-multi="true" id="WareHouse">
        <thead>
            <tr>
                <!--<th data-order-field="operation" align="center">业务</th>-->
                <th >序号</th>
                <th data-order-field="name">仓库名称</th>      
                <th data-order-field="">仓管</th>
                <th data-order-field="">联系号码</th>
                <th data-order-field="">创建时间</th>
                <th>地    区</th>

                <th >操作</th>
            </tr>
        </thead>
        <tbody>
           
        </tbody>
    </table>
</div>
<div class="bjui-pageFooter">
    <div class="pages">
        <span>每页&nbsp;</span>
        <div class="selectPagesize" >
            <select data-toggle="selectpicker" id="Select_WareHouse">
                <option value="15">15</option>
                <option value="30">30</option>
                <option value="50">50</option>
                <option value="100">100 </option>
            </select>
        </div>
        <span>&nbsp;条，共 <span id="WareCount"></span> 条</span>
    </div>
    <div class="pagination-box"  data-total="600" data-page-size="30" data-page-current="1" id="ware_pageination">
    </div>
</div>