<script src="/Admin/BJUI/ComJS/PageNumber.js"></script>
<script type="text/javascript">
 
    var depart = { index: 1, size: 5, max: 0, total: 0 };
    function PageDepart() {
        var DepartName = $("#Depart_Name").val(); 
        $.ajax({
            url: "/Ajax/AjaxDepartMent.ashx?action=GetPageDepart",
            data: {
                "DepartName":DepartName,
                "DepartIndex": depart.index,
                "DepartSize":depart.size
                  },
            type:"post",
            success:function (msg) {
                var json = JSON.parse(msg);
                var data = json["ReturnPage"];
                data = JSON.parse(data);
                var Obj = data[""];
                var html = [];
                var count = json["ReturnCount"];
                count = JSON.parse(count);
               depart.total = count[""][0]["Column1"];
               depart.max = Math.ceil(depart.total / depart.size);
                var xu = (depart.index - 1) * depart.size;             
                $.each(Obj, function (k, v) {
                    html.push("<tr>");
                    html.push("<td>"+(++xu)+"</td>")
                    html.push("<td>" + v["Department"] + "</td><td>" + v["sumUsers"] + "</td>")
                    html.push("<td>" + v["Dcreatedate"] + "</td><td>" + v["UserName"] + "</td>")
                    html.push("<td><a href='/Ajax/AjaxDepartMent.ashx?action=DelUser&Uid=" + v["DepartId"] + "' class='btn btn-red' data-toggle='doajax' data-confirm-msg='确定要删除该行信息吗？'>删除</a><a href='#' onclick='UpdateDepartMent(this,\"" + v["DepartId"] + "\",\"" + v["Department"] + "\")' class='btn btn-green' >编辑</a></td>")
                    html.push("</tr> ")
                });
                $("#DepartMentList tbody").empty().append(html.join(''));
                htmls = [];
                htmls.push("<ul class='pagination'>");
                htmls.push("<li class='d-first'><a href='javascript:'onclick='depart_first()'><span class='first'><i class='fa fa-step-backward'></i>首页</span></a></li>");
                htmls.push("<li class='d-prev'><a href='javascript:' onclick='depart_prev()'><span class='previous'><i class='fa fa-backward'></i>上一页</span></li>");
                //循环出页码
                for (var i = 1; i <= depart.max; i++) {
                    var cs = "j-sum";
                    if (i == depart.index) {
                        cs = "selected " + cs;
                    }
                    htmls.push("<li class='" + cs + "'><a href='javascript:'> " + i + "</a></li>")//显示页码
                }
                htmls.push("<li class='d-next' ><a href='javascript:' id='n' onclick='depart_next()'><span class='c_next' ><i class='fa fa-forward'></i>下一页</span></li>");
                htmls.push("<li class='d-last'><a href='javascript:' onclick='depart_last()' ><i class='fa fa-step-forward'></i>末页</a></li>")
                htmls.push('<li class="d-jumpto"><span class="p-input"><input class="form-control input-sm-pages" type="text" size="2.6" value="" title="输入跳转页码，回车确认" id="dgo"></span><a class="dgoto" href="javascript:;" title="跳转" onclick="depart_Jump()" ><i class="fa fa-chevron-right"></i></a></li>')
                htmls.push("<ul>");
                $("#div").html(depart.total);
                $("#DepartSet").empty().append(htmls.join(''));
                //DepartIndex1，让首页、上一页不可点击
                if (depart.index == 1) {
                    $(".d-first").addClass("disabled");
                    $(".d-prev").addClass("disabled");
                }
                //如果当前页等于最大页数,让下一页、尾页不可点击
                if (depart.index ==depart.max) {
                    $(".d-next").addClass("disabled");
                    $(".d-last").addClass("disabled");
                }
            }
        });
    }
    var Departid;
    function UpdateDepartMent(_this, id, name) {
        Departid = id;
        $(_this).dialog({ id: 'addDepart_dialog', onClose:"addDepat_onClose",url: '/Admin/DataBase/DepartMent/AddDepart.html?id=' + id + '', title: "编辑-" + name, reloadWarn: '本页已有打开的内容，确定将刷新本页内容，是否继续？',width:300,height:200 });
    }
    function addDepat_onClose($dialog) {
        Departid = undefined;
    }
    $(function () {
        PageDepart();
        $(".j-sum").live("click", function () {
            var PageNumValue = $(this).text();
            depart.index = PageNumValue;
            PageDepart();
        });
        $("#Select_Depart_Page").live("change", function () {
            var SelectValue = $("#Select_Depart_Page").find("option:selected").text();
            if (SelectValue > depart.total) {
                depart.index = 1;
            }
            depart.size = SelectValue;
            PageDepart();
        });
    });
    function depart_Jump() {
        $(".dgoto").live("click", function () {
            var Letgo = $("#dgo").val();
            if (Letgo > depart.max) {
                $(this).alertmsg('info', '你输入的数字超过页码范围');
                return false;
            }
            if (Letgo <1) {
                $(this).alertmsg('info', '请输入大于1的数字');
                return false;
            }
            if (isNaN(Letgo) || Letgo == "") {
                $(this).alertmsg('info', '请输入数字');
                return;
            }
            depart.index = Letgo;
            PageDepart();
        });
    }

    //下一页
    function depart_next() {
        if (depart.index <depart.max) {
            depart.index++;
     
            PageDepart();
        }
    }
    //上一页
    function depart_prev() {
        if (depart.index > 1) {
           depart.index--;
            PageDepart();
        }
    }
    //首页
    function depart_first() {
        depart.index = 1;
        PageDepart();
    }
    //尾页
    function depart_last() {
        depart.index = depart.max;
        PageDepart();
    }
    function ClearSelect() {
        $("#Depart_Name").val("");
        PageDepart();
    }
    function DepartSel() {
        var DepartName = $("#Depart_Name").val();
        PageDepart();
    }

</script>
<div class="bjui-pageHeader">
        <div class="bjui-searchBar">          
            <label>部门名称：</label><input type="text" value="" name="" id="Depart_Name" class="form-control" size="8">&nbsp;           
            <button type="button" class="btn-default" data-icon="search" onclick="DepartSel()" id="Sel">查询</button>&nbsp;
            <a class="btn btn-orange" href="javascript:;" data-toggle="reloadsearch" data-clear-query="true" data-icon="undo" onclick="ClearSelect()">清空查询</a>
            <div class="pull-right">
            <!--    <button type="button" class="btn-blue" data-url="/B-JUI/ajaxDone2.html?id={#bjui-selected}" data-toggle="doajax" data-confirm-msg="确定要删除选中项吗？" data-icon="remove" title="可以在控制台(network)查看被删除ID">删除选中行</button>&nbsp;-->
            <a href="/Admin/DataBase/DepartMent/AddDepart.html" class="btn btn-blue" data-toggle="dialog" data-width="300" data-height="200" data-id="addDepart_dialog" ata-icon="user" data-mask="true"><i class="fa fa-plus-square" size="10" aria-hidden="true">创建部门</i></a>
            </div>
        </div>
</div>
<div class="bjui-pageContent tableContent">
    <table class="table table-bordered table-hover table-striped table-top" data-selected-multi="true" id="DepartMentList">
        <thead>
            <tr>
                <th>序号</th>
                <th data-order-field="operation" align="center">部门名称</th>
                <th data-order-field="name">部门人数</th>
                <th>创建时间</th>
                <th>创建人</th>            
                <th width="100">操作</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</div>
<div class="bjui-pageFooter">
        <div class="pages">
            <span>每页&nbsp;</span>
            <div class="selectPagesize" id="div_GoodsPage">
                <select data-toggle="selectpicker" id="Select_Depart_Page">
                    <option value="15">15 </option>
                    <option value="30">30 </option>
                    <option value="50">50 </option>
                    <option value="100">100 </option>
                </select>
            </div>
        <span>&nbsp;共 <span  id="div"></span> 条</span>
    </div>
    <div class="pagination-box"  data-total="600" data-page-size="30" data-page-current="1" id="DepartSet">
    </div>
</div>