<script type="text/javascript">
    var addgoods = { index: 1, size: 15, max: 0, Sum: 0 };
    function EditGoodsPage() {
        var Likegoods = $("#Like_Goods").val();
        $.ajax({
            url: "/Ajax/AjaxInHostory.ashx?action=GetEditGoods",
            type: "post",
            data: {
                "Likegoods":Likegoods,
                "HIndex": addgoods.index,
                "HSize":addgoods.size,
            },
            success: function (msg) {
                var json = JSON.parse(msg);
                var data = json["StrPage"];
                data = JSON.parse(data);              
                var Item = data[""];
                var Count = json["StrCount"];
                var Total = JSON.parse(Count);
                addgoods.Sum = Total[""][0]["Column1"];
                addgoods.max = Math.ceil(addgoods.Sum / addgoods.size);              
                var html = [];
                var SerialNumber = (addgoods.index - 1) * addgoods.size;
                $.each(Item, function (k, v) {
                    html.push("<tr>")          
                    html.push("<td>"+(++SerialNumber)+"</td><td>" + v["Mnumber"] + "</td><td>" + v["Mname"] + "</td><td>" + v["DataText"] + "</td><td>" + v["UnitName"] + "</td>")
                    html.push("<td>" + v["Msellingprice"] + "</td><td>" + v["InvertorySum"] + "</td>")
                    html.push('<td><input type="checkbox" name="ids" data-toggle="icheck" value="{pid:' + v["Mid"] + ', nation:\'' + v["Mname"] + '\'}"></td>')
             
                    html.push('<td><a href="javascript:;" data-toggle="lookupback" data-args="{pid:' + v["Mid"] + ', nation:\'' + v["Mname"] + '\'}" class="btn btn-blue" title="选择本项" data-icon="check" >选择</a></td>')
                    html.push("</tr>")
                });
                $("#EditGoodsList tbody").empty().append(html.join(''));
                $("#EditGoodsCount").html(addgoods.Sum);
                htmls = [];
                htmls.push("<ul class='pagination'>");
                htmls.push("<li class='l-first'><a href='javascript:'onclick='Addgoods_first()'><span class='first'><i class='fa fa-step-backward'></i>首页</span></a></li>");
                htmls.push("<li class='l-prev'><a href='javascript:' onclick='Addgoods_prev()'><span class='previous'><i class='fa fa-backward'></i>上一页</span></li>");
                //循环出页码
                for (var i = 1; i <= addgoods.max; i++) {
                    var cs = "j-sum";
                    if (i == addgoods.index) {
                        cs = "selected " + cs;
                    }
                    htmls.push("<li class='" + cs + "'><a href='javascript:'> " + i + "</a></li>")//显示页码
                }
                htmls.push("<li class='l-next' ><a href='javascript:' id='n' onclick='Addgoods_next()'><span class='c_next' ><i class='fa fa-forward'></i>下一页</span></li>");
                htmls.push("<li class='l-last'><a href='javascript:' onclick='Addgoods_last()' ><i class='fa fa-step-forward'></i>末页</a></li>")
                htmls.push('<li class="l-jumpto"><span class="p-input"><input class="form-control input-sm-pages" type="text" size="2.6" value="" title="输入跳转页码，回车确认" id="lgo"></span><a class="lgoto" href="javascript:;" title="跳转" onclick="Addgoods_Jump()" ><i class="fa fa-chevron-right"></i></a></li>')
                htmls.push("<ul>");
                $("#edit_Goods").empty().append(htmls.join(''));
                if (addgoods.index == 1) {
                    $(".l-first").addClass("disabled");
                    $(".l-prev").addClass("disabled");
                }
                if (addgoods.index == addgoods.max) {
                    $(".l-next").addClass("disabled");
                    $(".l-last").addClass("disabled");
                }
            }
        });
    }
    $(function () {
        EditGoodsPage();
        $(".j-sum").live("click", function () {
            var ClickValue = $(this).text();
            addgoods.index = ClickValue;
            EditGoodsPage();
        });
        //选择下拉值跳转
        $("#Selcetdiv").live("change", function () {
            var GoodsSelect = $("#SelectSize").find("option:selected").text();
           
            if (GoodsSelect > addgoods.index) {
                addgoods.index = 1;
            }
            addgoods.size = GoodsSelect;
            EditGoodsPage();
        });
    });
    //首页
    function Addgoods_first() {
        addgoods.index = 1;
        EditGoodsPage();
    }
    //下一页
    function Addgoods_next() {
        if (addgoods.index < addgoods.max) {
            addgoods.index++;
            EditGoodsPage();
        }
    }
    //上一页
    function Addgoods_prev() {
        if (addgoods.index > 1) {
            addgoods.index--;
            EditGoodsPage();
        }
    }
    //尾页
    function Addgoods_last() {
        addgoods.index = addgoods.max;
        EditGoodsPage()
    }

    function ClearGoods() {
        $("#Like_Goods").val("");
        EditGoodsPage();
    }
    //输入跳转
    function Addgoods_Jump() {
        $(".lgoto").live("click", function () {
            var InputValue = $("#lgo").val();
            if (InputValue > addgoods.max) {
                $(this).alertmsg('info', '你输入的数字超过页面范围');
                return false;
            }
            if (InputValue < 1) {
                $(this).alertmsg('info', '请输入大于1的数字');
                return false;
            }
            if (isNaN(Number(InputValue)) || InputValue == "") {
                $(this).alertmsg('info', '请输入数字');
                return;
            }
            addgoods.index = InputValue;
            EditGoodsPage();
        });
    }
</script>

<div class="bjui-pageHeader">
    <form id="pagerForm" data-toggle="ajaxsearch" action="table-edit-lookup.html" method="post">
        <input type="hidden" name="pageCurrent" value="1">
        <input type="hidden" name="pageSize" value="${model.pageSize}">
        <input type="hidden" name="orderField" value="${param.orderField}">
        <div class="bjui-searchBar">
            <label>名称：</label><input type="text" value="" name="code" size="10" id="Like_Goods">&nbsp;
            <button type="button" class="btn-default" data-icon="search"  onclick="EditGoodsPage()">查询</button>&nbsp;
            <a class="btn btn-orange" href="javascript:;"  data-clear-query="true" data-icon="undo"  onclick="ClearGoods()">清空查询</a>
            <div class="pull-right">
                <button type="button" class="btn-blue" data-toggle="lookupback" data-lookupid="ids" data-warn="请至少选择一项职业" data-icon="check-square-o">选择选中</button>
            </div>
        </div>
    </form>
</div>
<div class="bjui-pageContent tableContent" id="EditGoodsList">
    <table data-toggle="tablefixed" data-width="150%"  >
        <thead>
            <tr>
                <th data-order-field="id">序号.</th>        
                <th data-order-field="number" width="100">商品编号</th>  
                <th data-order-field="name">商品名称</th>
                <th data-order-field="model">型号</th>
                <th data-order-field="unit">单位</th>
                <th data-order-field="price">单价</th>
                <th data-order-field="Inventory_sum">库存数量</th>
                <th width="28"><input type="checkbox" class="checkboxCtrl" data-group="ids" data-toggle="icheck"></th>
                <!--<th class="orderby" data-order-direction="asc" data-order-field="date">创建日期</th>-->
                <!--<th width="28"><input type="checkbox" class="checkboxCtrl" data-group="ids" data-toggle="icheck"></th>-->
                <th width="74">操作</th>
            </tr>
        </thead>
        <tbody>
       
        </tbody>
    </table>
</div>
<div class="bjui-pageFooter">
    <div class="pages">
        <span>每页&nbsp;</span>
        <div class="selectPagesize" id="Selcetdiv">
            <select data-toggle="selectpicker" id="SelectSize">
             <option value="15">15 </option>
                <option value="30">30 </option>
                <option value="50">50 </option>
                <option value="100">100 </option>
            </select>
        </div>
        <span>&nbsp;条，共 <span id="EditGoodsCount"></span> 条</span>
    </div>
    <div class="pagination-box" id="edit_Goods" data-total="7" data-page-size="30" data-page-current="1">
    </div>
</div>
