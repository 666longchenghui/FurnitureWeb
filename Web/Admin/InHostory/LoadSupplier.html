<script type="text/javascript">    
    var load = { index: 1, size: 15, max: 0, total: 0 };
    //清空查询文本
    function Clear() {
        $("#LikeName").val("");
    }
    function SuPage(){
        var Like_Name = $("#Supplier_Name").val();
        $.ajax({
            url: "/Ajax/AjaxInHostory.ashx?action=GetSuppliers",
            type: "post",
            data: {
                "likename": Like_Name,
                "SupplierPageIndex": load.index,
                "SupplierPageSize": load.size
            },
            success: function (msg) {
                var json = JSON.parse(msg);
                var data = json["Page"];
                data = JSON.parse(data);
                var Obj = data[""];
                var Count = json["Count"];
                Count = JSON.parse(Count);
                load.total = Count[""][0]["Column1"];//总记录数
                load.max = Math.ceil( load.total / load.size);//采用向上取整，求出最大页
                var html = [];
                var SerialNumber = (load.index - 1) * load.size;
                $.each(Obj, function (k, v) {           
                    html.push("<tr><td>" + (++SerialNumber)+ "</td><td>" + v["SCompanyName"] + "</td>");               
                    html.push("<td><a href='javascript:;'data-toggle='lookupback' data-args=\"{pids:'" + v["Superid"] + "', Supplier:'" + v["SCompanyName"] + "'}\" class='btn btn-blue' title='选择本项' data-icon='check'>选择</a></td>")
                    html.push("</tr>");
                });

                $("#EditSupplier_List tbody").empty().append(html.join(''));
                $("#LoadSupplierCount").html(load.total);//显示记录数
                $("#InHoustory_sum").html(load.totalsum);
                htmls = [];
                htmls.push("<ul class='pagination'>");
                htmls.push("<li class='l-first'><a href='javascript:'onclick='load_first()'><span class='first'><i class='fa fa-step-backward'></i>首页</span></a></li>");
                htmls.push("<li class='l-prev'><a href='javascript:' onclick='load_prev()'><span class='previous'><i class='fa fa-backward'></i>上一页</span></li>");
                //循环出页码
                for (var i = 1; i <= load.max; i++) {
                    var cs = "j-sum";
                    if (i == load.index) {
                        cs = "selected " + cs;
                    }
                    htmls.push("<li class='" + cs + "'><a href='javascript:'> " + i + "</a></li>")//显示页码
                }
                htmls.push("<li class='l-next' ><a href='javascript:' id='n' onclick='load_next()'><span class='c_next' ><i class='fa fa-forward'></i>下一页</span></li>");
                htmls.push("<li class='l-last'><a href='javascript:' onclick='load_last()' ><i class='fa fa-step-forward'></i>末页</a></li>")
                htmls.push('<li class="l-jumpto"><span class="p-input"><input class="form-control input-sm-pages" type="text" size="2.6" value="" title="输入跳转页码，回车确认" id="lgo"></span><a class="lgoto" href="javascript:;" title="跳转" onclick="load_Jump()" ><i class="fa fa-chevron-right"></i></a></li>')
                htmls.push("<ul>");


                $("#LoadSupplierPage").empty().append(htmls.join(''));
                //如果当前页等于1，让首页、上一页不可点击
                if (load.index == 1) {
                    $(".l-first").addClass("disabled");
                    $(".l-prev").addClass("disabled");
                }
                //如果当前页等于最大页数,让下一页、尾页不可点击
                if (load.index == load.max) {
                    $(".l-next").addClass("disabled");
                    $(".l-last").addClass("disabled");
                }
            }
        });
    }
    $(function () {
        SuPage();
        //点击页码跳转
        $(".j-sum").live("click", function () {
            var PageNumValue = $(this).text();
            load.index = PageNumValue;
            SuPage();
        });
        //选择下拉值跳转
        $("#ChangeSelect").live("change", function () {
            var GoodsSelect = $("#selectoption").find("option:selected").text();
          
            if (GoodsSelect > load.index) {
                load.index = 1;
            }
            load.size = GoodsSelect;
            SuPage();
        });
    });
    //下一页
    function load_next() {
        if (load.index < load.max) {
            load.index++;
            SuPage();
        }
    }
    //上一页
    function load_prev() {
        if (load.index > 1) {
            load.index--;
            SuPage();
        }
    }
    //首页
    function load_first() {
        load.index = 1;
        SuPage();
    }
    //尾页
    function load_last() {
        load.index = load.max;
        SuPage();
    }
    //输入值跳转
    function load_Jump() {
        var goto = $("#lgo").val();
        if (goto > load.max) {
            $(this).alertmsg('info', '你输入的数字超过页面范围');
            return;
        }
        if (isNaN(Number(goto)) || goto == "") {
            $(this).alertmsg('info', '请输入数字');
            return;
        }
        if (goto < 1) {
            $(this).alertmsg('info', '请输入大于1的数字');
            return;
        }
        load.index = goto;
        SuPage();
    }
    function LikeSelect() {
        SuPage();
    }
    function ClearSelect() {
        $("#Supplier_Name").val("");
        SuPage();
    }
    
</script>
<div class="bjui-pageHeader">
    <form id="pagerForm" data-toggle="ajaxsearch" action="table-edit-lookup.html" method="post">
        <input type="hidden" name="pageCurrent" value="1">
        <input type="hidden" name="pageSize" value="${model.pageSize}">
        <input type="hidden" name="orderField" value="${param.orderField}">
        <div class="bjui-searchBar">
            <label>名称：</label><input type="text" value="" id="Supplier_Name" size="10">&nbsp;
            <button type="button" class="btn-default" data-icon="search" onclick="LikeSelect()">查询</button>&nbsp;
            <a class="btn btn-orange" href="#" data-toggle="" data-clear-query="true" data-icon="undo" onclick="ClearSelect()">清空查询</a>
            <!--<div class="pull-right">
                <button type="button" class="btn-blue" data-toggle="lookupback" data-lookupid="ids" data-warn="请至少选择一项职业" data-icon="check-square-o">选择选中</button>
            </div>-->
        </div>
    </form>
</div>
<div class="bjui-pageContent tableContent" id="EditSupplier_List">
    <table data-toggle="tablefixed" data-width="100%">
        <thead>
            <tr>
                <th data-order-field="id">序号</th>
                <th data-order-field="model">供应商名称</th>
                <th width="74">操作</th>
            </tr>
        </thead>
        <tbody>      
        </tbody>
    </table>
</div>
<div class="bjui-pageFooter">
    <div class="pages">
        <span>每页&nbsp;</span>
        <div class="selectPagesize" id="ChangeSelect">
            <select data-toggle="selectpicker" id="selectoption">
                <option value="15">15 </option>
                <option value="30">30 </option>
                <option value="50">50 </option>
                <option value="100">100 </option>
            </select>
        </div>
        <span>&nbsp;条，共 <span id="LoadSupplierCount"></span> 条</span>
    </div>
    <div class="pagination-box"  data-total="7" data-page-size="30" data-page-current="1" id="LoadSupplierPage">
    </div>
</div>

